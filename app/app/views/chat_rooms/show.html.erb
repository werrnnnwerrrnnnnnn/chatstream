<% content_for :title, "Chat Room" %>

<div id="chat-room-id"
     data-chat-room-id="<%= @chat_room.id %>"
     data-sender-id="<%= current_user.id %>"
     data-is-streamer="<%= current_user == @chat_room.streamer %>"
     class="container my-4">

  <% if current_user == @chat_room.streamer %>
    <div class="mb-3">
      <button id="start-stream" class="btn btn-danger">ğŸ¥ Start Streaming</button>
    </div>
  <% end %>

  <div class="row">
    <!-- ğŸ¥ Video Section -->
    <div class="col-md-4 mb-4">
      <div class="card shadow-sm">
        <div class="card-body text-center">
          <% if current_user == @chat_room.streamer %>
            <video id="localVideo" autoplay muted playsinline class="rounded border mb-2" style="width: 100%;"></video>
            <p id="video-status" class="text-muted small">ğŸ“¡ Waiting to start stream...</p>
          <% end %>
          <video id="remoteVideo" autoplay playsinline muted style="display: none;"></video>
        </div>
      </div>
    </div>

    <!-- ğŸ’¬ Messages Section -->
    <div class="col-md-8 d-flex flex-column">
      <div class="card shadow-sm mb-3 flex-grow-1 overflow-hidden">
        <div class="card-body overflow-auto" id="messages" style="max-height: 400px;">
          <%= turbo_stream_from @chat_room %>
          <%= render @chat_room.messages %>
        </div>
      </div>

      <%= form_with(model: [@chat_room, Message.new], local: false, data: { controller: "message-submit reset-form", action: "turbo:submit-end->reset-form#reset" }, class: "mb-4") do |form| %>
        <div class="mb-2">
          <%= form.text_area :content, placeholder: "Type your message...", class: "form-control", rows: 3 %>
        </div>
        <%= form.submit "Send", class: "btn btn-primary" %>
      <% end %>
    </div>

  <!-- ğŸ”— Action Buttons -->
  <div class="d-flex justify-content-between mt-4">
    <div>
      <%= link_to "âœï¸ Edit this chat room", edit_chat_room_path(@chat_room), class: "btn btn-outline-secondary me-2" %>
      <%= link_to "ğŸ”™ Back to chat rooms", chat_rooms_path, class: "btn btn-outline-primary" %>
    </div>
    <%= button_to "ğŸ—‘ï¸ Destroy this chat room", @chat_room, method: :delete, class: "btn btn-danger" %>
  </div>
</div>